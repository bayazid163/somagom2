{%load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Bag | Somagom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Marcellus&family=Public+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --heritage-red: #A33B26;
            --clay-white: #F9F7F2; 
            --ink-black: #2A2420;  
        }
        body { 
            font-family: 'Public Sans', sans-serif; 
            background-color: var(--clay-white); 
            color: var(--ink-black); 
            background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png");
        }
        .serif { font-family: 'Marcellus', serif; }
        .brand-color { color: var(--heritage-red); }
        .brand-bg { background-color: var(--heritage-red); }
        
        .logo-box {
            border: 2px solid var(--heritage-red);
            padding: 4px 12px;
            display: inline-block;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .cart-item {
            border-bottom: 1px solid rgba(163, 59, 38, 0.1);
            padding: 2rem 0;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body>

    <nav class="flex justify-between items-center px-6 md:px-10 py-6 sticky top-0 z-50 bg-[#F9F7F2]/95 backdrop-blur-md border-b border-stone-200">
        <a href="{%url ''%}" class="logo-box brand-color">
            <div class="text-xl serif tracking-tighter">SOMAGOM</div>
        </a>
        <div class="hidden md:flex space-x-8 text-[11px] uppercase tracking-widest font-bold text-stone-500">
            <a href="{%url ''%}">Home</a>
            <a href="{%url 'fashion'%}">Fashion</a>
            <a href="{%url 'food'%}">GI Food</a>
            <a href="{%url 'craft'%}">Crafts</a>
        </div>
        <div class="text-[11px] uppercase tracking-widest font-bold brand-color">Cart</div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 py-16">
        <h1 class="text-4xl serif mb-12">Your <span class="italic">Shopping Bag</span></h1>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-16">
            
            <div class="lg:col-span-2">
                <div class="hidden md:grid grid-cols-4 pb-4 border-b border-stone-200 text-[10px] uppercase tracking-[0.2em] font-bold text-stone-400">
                    <div class="col-span-2">Product</div>
                    <div>Quantity</div>
                    <div class="text-right">Total</div>
                </div>

{% for item in items %}
<div class="cart-item grid grid-cols-1 md:grid-cols-4 items-center gap-6" id="row-{{ item.product.id }}">
    <div class="col-span-2 flex items-center space-x-6">
        <img src="{{ item.product.image.url }}" class="w-24 h-32 object-cover border border-stone-200">
        <div>
            <h3 class="serif text-xl mb-1">{{ item.product.product_name }}</h3>
            <p class="text-[10px] uppercase tracking-widest text-stone-400 mb-2">Origin: {{ item.product.origin }}</p>
            <button onclick="updateCart('{{ item.product.id }}', 'remove')" class="text-[10px] uppercase font-bold text-stone-400 hover:text-red-700 underline transition">Remove</button>
        </div>
    </div>
    <div class="flex items-center">
        <div class="flex border border-stone-300">
            <button onclick="updateCart('{{ item.product.id }}', 'decrease')" class="px-3 py-1 hover:bg-stone-100 border-r border-stone-300">-</button>
            <input type="number" id="qty-{{ item.product.id }}" value="{{ item.quantity }}" class="w-12 text-center bg-transparent text-sm focus:outline-none" readonly>
            <button onclick="updateCart('{{ item.product.id }}', 'increase')" class="px-3 py-1 hover:bg-stone-100 border-l border-stone-300">+</button>
        </div>
    </div>
    <div class="text-right">
        <span class="serif text-lg" id="subtotal-{{ item.product.id }}">৳ {{ item.subtotal }}</span>
    </div>
</div>
{% empty %}
<p class="text-center py-10">Your bag is empty.</p>
{% endfor %}

                <div class="mt-10">
                    <a href="{%url 'fashion'%}" class="text-[10px] uppercase font-bold tracking-[0.2em] border-b border-stone-800 pb-1 hover:brand-color hover:border-brand-color transition">← Continue Browsing</a>
                </div>
            </div>

            <div class="lg:col-span-1">
                <div class="bg-white border border-stone-200 p-8 sticky top-32">
                    <h2 class="serif text-2xl mb-6">Summary</h2>
                    
                    <div class="space-y-4 mb-8">
                        <div class="flex justify-between text-sm">
                            <span class="text-stone-500">Subtotal</span>
                            <span>৳ 36,200</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-stone-500">Shipping (Standard)</span>
                            <span>৳ 120</span>
                        </div>
                        <div class="flex justify-between text-sm border-t border-stone-100 pt-4 font-bold">
                            <span>Total</span>
                            <span class="brand-color text-xl">৳ 36,320</span>
                        </div>
                    </div>

                    <button class="w-full brand-bg text-white py-4 text-xs uppercase font-bold tracking-widest hover:opacity-90 transition mb-6">
                        Proceed to Checkout
                    </button>

                    <div class="bg-[#F2EBE1] p-4 flex items-start space-x-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 brand-color" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04kM12 21.355l7.117-7.117a10 10 0 11-14.234 0L12 21.355z" />
                        </svg>
                        <div>
                            <h4 class="text-[10px] font-bold uppercase tracking-widest mb-1">GI Guarantee</h4>
                            <p class="text-[9px] text-stone-500 leading-relaxed uppercase">Each item is sourced directly from certified artisan cooperatives.</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <footer class="py-12 border-t border-stone-200 text-center">
        <p class="text-[9px] uppercase tracking-[0.4em] text-stone-400">© 2025 SOMAGOM — Secure Checkout</p>
    </footer>






    <script>
async function updateCart(productId, action) {
    let url = (action === 'increase') ? `/cart/add/${productId}/` : `/cart/decrease/${productId}/`;
    
    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            }
        });

        if (response.status === 403 || response.status === 401) {
            window.location.href = "{% url 'login' %}";
            return;
        }

        const data = await response.json();

        if (response.ok) {
            if (data.quantity === 0 || action === 'remove') {
                document.getElementById(`row-${productId}`).remove();
            } else {
                
                document.getElementById(`qty-${productId}`).value = data.quantity;
                document.getElementById(`subtotal-${productId}`).innerText = "৳ " + data.subtotal;
            }
            
            document.getElementById('cart-total-price').innerText = "৳ " + data.cart_total;
        }
    } catch (error) {
        console.error("Error updating cart:", error);
    }
}
</script>

</body>
</html>